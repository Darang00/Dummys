<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
	//회원가입
	public int insertUser(Users users);
	
	//아이디 체크
	public int idCheck(String userid);
	
	//로그인 체크
	public int loginCheck(String userid, String password);
	
	//회원 상세
	public Users userDetail(String userid);
	
	//회원 수정
	public int updateUser(Users users);
	
	//전체 회원(활성화된)
	public List<Users> listUsers();
	
	//전체회원(비활성화된)
	public List<Users> listOutUsers();
 -->

<mapper namespace="kr.or.dummys.dao.UserDao">
	<insert id = "insertUser" parameterType="kr.or.dummys.dto.Users">
		insert into users(userid, password, nickname, enabled) 
        values(#{userid}, #{password}, #{nickname}, 1)
	</insert>
	
	<select id="idCheck" parameterType="String" resultType="int">
		select count(*) from users where userid=#{userid}
	</select>
	
	<select id="loginCheck" resultType="int">
		select count(*) from users where userid=#{param1} and pwd =#{param2}
	</select>
	
	<select id="userDetail" resultType="kr.or.dummys.dto.Users">
		select userid, password, nickname, enabled where userid = #{userid}
	</select>
	
	<update id="updateUser">
		update users
		set password = #{password}, nickname=#{nickname} where userid = #{userid}
	</update>
	
	<select id="listUsers" resultType="kr.or.dummys.dto.Users">
		select u.userid as userid, password, nickname, enabled from users u join users_role r on u.userid = r.userid where u.enabled=1 and r.role_name = 'ROLE_USER'
		
	</select>
	
	<select id="listOutUsers" resultType="kr.or.dummys.dto.Users">
		select u.userid as userid, password, nickname, enabled from users u join users_role r on u.userid = r.userid where u.enabled!=1 and r.role_name = 'ROLE_USER'
	</select>
	
	<select id="myBoardList" resultType="kr.or.dummys.dto.Board">
	 select * from board where userid=#{userid}
	</select> 
	
	<select id="myReplyBoardList" resultType="kr.or.dummys.dto.Board">
	  select board.board_no, board.board_kind, board.board_name, to_char(board.board_date,'yyyy-mm-dd') as board_date from reply inner join board on board.board_no = reply.board_no where reply.userid=#{userid} group by board.board_no, board_kind,board_name, board_date
	</select>
</mapper>